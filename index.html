<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link href="./assets/css/reset.css" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
        crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Cabin+Sketch|Gugi|Miniver|Neucha|Rajdhani" rel="stylesheet">
    <link href="./assets/css/style.css" rel="stylesheet">
    <title>Giphy Butt</title>
</head>

<body>
    <div class="container1 container jumbotron">
        <div class="row">
            <div class="col-sm">
                <h1>Giphy Butt</h1>
                <p>Check out the gifs by pushing a button or searching for your own!</p>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-4">
                <div class="form-group">
                    <label for="animal">Gif Keyword</label>
                    <input type="keyword" class="form-control" id="input" placeholder="Keyword">
                </div>
                <button type="submit" id="submit" class="btn btn-danger">Submit</button>
                </form>
            </div>
            <div class="col-sm-8" id="addnewbuttons">

            </div>
        </div>
    </div>
    <div class="container3 container mx-auto jumbotron">
        <div class="row">
            <div id="gifs-appear-here" class="col-sm">

            </div>
        </div>
    </div>
    <script type="text/javascript">

        $(document).ready(function () {
            var animals = ["Narwhal", "Unicorn", "Wolf", "Dinosaur"];

            $("#submit").on("click", function () {
                // event.preventDefault() prevents the form from trying to submit itself.
                // We're using a form so that the user can hit enter instead of clicking the button if they want
                event.preventDefault();
                var keyword = $("#input").val().trim();
                animals.push(keyword);
                renderButtons();
                console.log(animals)
            });

            renderButtons();
            function renderButtons() {
                // (this is necessary otherwise we will have repeat buttons)
                $("#addnewbuttons").empty();

                // Looping through the array of animals
                for (var i = 0; i < animals.length; i++) {
                    var newButton = $("<button type='button'>");
                    newButton.attr("data-animal", animals[i]);
                    newButton.addClass("btn btn-danger animalButton");
                    newButton.text(animals[i]);
                    // Adding the button to the HTML
                    $("#addnewbuttons").append(newButton);
                }
            }

            // This function handles events where one button is clicked

            $(".animalButton").on("click", function () {
                var animalName = $(this).attr("data-animal");
                console.log(this)
                var queryURL = "https://api.giphy.com/v1/gifs/search?q=" +
                    animalName + "&api_key=dc6zaTOxFJmzC&limit=10";
                $("#gifs-appear-here").empty();



                $.ajax({
                    url: queryURL,
                    method: "GET"
                }).then(function (response) {

                    console.log(response);
                    var results = response.data;


                    for (var i = 0; i < results.length; i++) {
                        var animalDiv = $("<div>");
                        var p = $("<p>" + "Rating: " + results[i].rating + "</p>");
                        var animalImage = $("<img class='gif' data-state='still'>");
                        var animalImageMove = results[i].images.fixed_height.url;
                        var animalImageStill = results[i].images.fixed_height_still.url;
                        animalImage.attr('src', animalImageStill);
                        animalImage.attr('data-animate', animalImageMove);
                        animalImage.attr("data-still", animalImageStill);
                        $(animalDiv).append(p);
                        $(animalDiv).append(animalImage);
                        $("#gifs-appear-here").prepend(animalDiv);

                    }

                    $(".gif").on("click", function () {
                        var state = $(this).attr("data-state");
                        if (state === "still") {
                            $(this).attr("src", $(this).attr("data-animate"));
                            $(this).attr("data-state", "animate");
                        } else {
                            $(this).attr("src", $(this).attr("data-still"));
                            $(this).attr("data-state", "still");
                        }
                    });
                });
            })


        })

    </script>
</body>

</html>